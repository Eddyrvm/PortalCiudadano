@model PortalCiudadano.Models.ServiciosPublicos.ServicioLimpeza

@{
    ViewBag.Title = "Edit";
}

@using (Html.BeginForm("Edit", "ServicioLimpezas", FormMethod.Post, new { id = "miFormulario", enctype = "multipart/form-data" }))
{
    @Html.AntiForgeryToken()
    <div class="form-horizontal">
        <div class="card shadow p-4">
            <h4 class="card-title d-flex justify-content-between align-items-center">
                <!-- Modificar estado de la solicitud a la izquierda -->
                <span class="d-flex align-items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" class="bi bi-hourglass-split" viewBox="0 0 16 16" style="margin-bottom: 3px;">
                        <path d="M2.5 15a.5.5 0 1 1 0-1h1v-1a4.5 4.5 0 0 1 2.557-4.06c.29-.139.443-.377.443-.59v-.7c0-.213-.154-.451-.443-.59A4.5 4.5 0 0 1 3.5 3V2h-1a.5.5 0 0 1 0-1h11a.5.5 0 0 1 0 1h-1v1a4.5 4.5 0 0 1-2.557 4.06c-.29.139-.443.377-.443.59v.7c0 .213.154.451.443.59A4.5 4.5 0 0 1 12.5 13v1h1a.5.5 0 0 1 0 1zm2-13v1c0 .537.12 1.045.337 1.5h6.326c.216-.455.337-.963.337-1.5V2zm3 6.35c0 .701-.478 1.236-1.011 1.492A3.5 3.5 0 0 0 4.5 13s.866-1.299 3-1.48zm1 0v3.17c2.134.181 3 1.48 3 1.48a3.5 3.5 0 0 0-1.989-3.158C8.978 9.586 8.5 9.052 8.5 8.351z" />
                    </svg>
                    Modificar estado de la solicitud
                </span>
            </h4>

            <!-- Fecha de la solicitud a la derecha -->
            <div class="text-end">
                <label class="form-label fw-bold text-primary text-end">
                    <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" fill="currentColor" class="bi bi-calendar-check-fill" viewBox="0 0 16 16" style="margin-bottom: 3px;">
                        <path d="M4 .5a.5.5 0 0 0-1 0V1H2a2 2 0 0 0-2 2v1h16V3a2 2 0 0 0-2-2h-1V.5a.5.5 0 0 0-1 0V1H4zM16 14V5H0v9a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2m-5.146-5.146-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708" />
                    </svg>
                    Fecha de la Solicitud
                </label>
                <h5>
                    <span class="badge text-bg-warning">@Model.FechaSolicitud.ToString("dd/MM/yyyy - HH:mm:ss")</span>
                </h5>
            </div>


            <hr />
            @Html.ValidationSummary(true, "", new { @class = "text-danger" })
            @Html.HiddenFor(model => model.ServicioLimpezaId)
            @Html.HiddenFor(model => model.Institucion)
            @Html.HiddenFor(model => model.Calle)
            @Html.HiddenFor(model => model.Referencia)
            @Html.HiddenFor(model => model.FechaSolicitud)
            @Html.HiddenFor(model => model.TipoServicioId)
            @Html.HiddenFor(model => model.UserId)
            @Html.HiddenFor(model => model.Foto)
            @Html.HiddenFor(model => model.Telefono)
            @Html.HiddenFor(model => model.DetalleActividad)



            <!-- Información en dos columnas -->
            <div class="row mt-3">

                <div class="col-md-6">
                    <p>
                        <strong class="text-black-50">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-alarm" viewBox="0 0 16 16" style="margin-bottom: 3px;">
                                <path d="M8.5 5.5a.5.5 0 0 0-1 0v3.362l-1.429 2.38a.5.5 0 1 0 .858.515l1.5-2.5A.5.5 0 0 0 8.5 9z" />
                                <path d="M6.5 0a.5.5 0 0 0 0 1H7v1.07a7.001 7.001 0 0 0-3.273 12.474l-.602.602a.5.5 0 0 0 .707.708l.746-.746A6.97 6.97 0 0 0 8 16a6.97 6.97 0 0 0 3.422-.892l.746.746a.5.5 0 0 0 .707-.708l-.601-.602A7.001 7.001 0 0 0 9 2.07V1h.5a.5.5 0 0 0 0-1zm1.038 3.018a6 6 0 0 1 .924 0 6 6 0 1 1-.924 0M0 3.5c0 .753.333 1.429.86 1.887A8.04 8.04 0 0 1 4.387 1.86 2.5 2.5 0 0 0 0 3.5M13.5 1c-.753 0-1.429.333-1.887.86a8.04 8.04 0 0 1 3.527 3.527A2.5 2.5 0 0 0 13.5 1" />
                            </svg>
                            Tipo de Servicio: @Html.DisplayFor(modelItem => Model.TipoServicio.NombreServicio)
                        </strong>
                    </p>
                    <p><strong>Solicitante:</strong> @Html.DisplayFor(modelItem => Model.User.FullName)</p>
                    <p><strong>Contacto:</strong> @Html.DisplayFor(modelItem => Model.Telefono)</p>
                    <p><strong>Institución:</strong> @Html.DisplayFor(modelItem => Model.Institucion)</p>
                    <p><strong>Calle:</strong> @Html.DisplayFor(modelItem => Model.Calle)</p>
                    <p><strong>Referencia:</strong> @Html.DisplayFor(modelItem => Model.Referencia)</p>
                    <p><strong>Descripción de la solicitud:</strong> @Html.DisplayFor(modelItem => Model.DetalleActividad)</p>

                    <div class="form-group">
                        <label class="form-label fw-bold">Foto de referencia</label>
                        <div>
                            @if (!string.IsNullOrEmpty(Model.Foto))
                            {
                                <img src="@Url.Content(Model.Foto)" class="img-fluid rounded shadow" style="max-width: 800px; height: auto;" alt="Imagen de la actividad">
                                <p class="text-muted">Foto proporcionada por el usuario</p>
                            }
                            else
                            {
                                <img src="~/Content/Imagenes/no-user.png" class="img-fluid rounded shadow" />
                                <p class="text-muted">Sin imagen disponible</p>
                            }
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-group">
                        @Html.LabelFor(model => model.ActividadRealizada, new { @class = "form-label fw-bold" })
                        @Html.TextAreaFor(model => model.ActividadRealizada, new { @class = "form-control", rows = "3" })
                    </div>

                    <div class="form-group">
                        @Html.LabelFor(model => model.EstadoSolicitud, new { @class = "form-label fw-bold" })
                        @Html.DropDownListFor(model => model.EstadoSolicitud, new SelectList(new[] { "Pendiente", "Atendido", "Resuelto" }), "[Seleccione...]", new { @class = "form-control" })
                    </div>
                    <div class="mt-4 text-center">
                        <button type="button" class="btn btn-primary" onclick="confirmarEnvio()">Guardar</button>
                        @Html.ActionLink("Cancelar", "Index", null, new { @class = "btn btn-secondary" })
                        <button type="submit" class="btn btn-warning">Imprimir solicitud</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
}


@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script>
    function confirmarEnvio() {
        Swal.fire({
            title: "¿Estás seguro?",
            text: "Se guardarán los cambios en el sistema.",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Sí, guardar",
            cancelButtonText: "Cancelar"
        }).then((result) => {
            if (result.isConfirmed) {
                document.getElementById("miFormulario").submit();
            }
        });
    }
    </script>

}
