@model IEnumerable<PortalCiudadano.Models.MapaSitios.MapSitio>

@{
    ViewBag.Title = "Coordenadas";
}
<div class="container-fluid ">

    <div class="nav-scroller">
        <nav class="nav d-flex flex-wrap gap-1 mb-1" aria-label="Secondary navigation">
            <a href="https://ejemplo.com/primary" class="text-decoration-none">
                <span class="badge rounded-pill text-bg-secondary d-inline-flex align-items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-house-heart me-1" viewBox="0 0 16 16">
                        <path d="M8 6.982C9.664 5.309 13.825 8.236 8 12 2.175 8.236 6.336 5.309 8 6.982" />
                        <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.707L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.646a.5.5 0 0 0 .708-.707L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293zM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5z" />
                    </svg>
                    El Cantón
                </span>
            </a>

            <a href="https://ejemplo.com/primary" class="text-decoration-none">
                <span class="badge rounded-pill text-bg-secondary d-inline-flex align-items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-geo" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M8 1a3 3 0 1 0 0 6 3 3 0 0 0 0-6M4 4a4 4 0 1 1 4.5 3.969V13.5a.5.5 0 0 1-1 0V7.97A4 4 0 0 1 4 3.999zm2.493 8.574a.5.5 0 0 1-.411.575c-.712.118-1.28.295-1.655.493a1.3 1.3 0 0 0-.37.265.3.3 0 0 0-.057.09V14l.002.008.016.033a.6.6 0 0 0 .145.15c.165.13.435.27.813.395.751.25 1.82.414 3.024.414s2.273-.163 3.024-.414c.378-.126.648-.265.813-.395a.6.6 0 0 0 .146-.15l.015-.033L12 14v-.004a.3.3 0 0 0-.057-.09 1.3 1.3 0 0 0-.37-.264c-.376-.198-.943-.375-1.655-.493a.5.5 0 1 1 .164-.986c.77.127 1.452.328 1.957.594C12.5 13 13 13.4 13 14c0 .426-.26.752-.544.977-.29.228-.68.413-1.116.558-.878.293-2.059.465-3.34.465s-2.462-.172-3.34-.465c-.436-.145-.826-.33-1.116-.558C3.26 14.752 3 14.426 3 14c0-.599.5-1 .961-1.243.505-.266 1.187-.467 1.957-.594a.5.5 0 0 1 .575.411" />
                    </svg>
                    Calceta
                </span>
            </a>

            <a href="https://ejemplo.com/primary" class="text-decoration-none">
                <span class="badge rounded-pill text-bg-secondary d-inline-flex align-items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-geo" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M8 1a3 3 0 1 0 0 6 3 3 0 0 0 0-6M4 4a4 4 0 1 1 4.5 3.969V13.5a.5.5 0 0 1-1 0V7.97A4 4 0 0 1 4 3.999zm2.493 8.574a.5.5 0 0 1-.411.575c-.712.118-1.28.295-1.655.493a1.3 1.3 0 0 0-.37.265.3.3 0 0 0-.057.09V14l.002.008.016.033a.6.6 0 0 0 .145.15c.165.13.435.27.813.395.751.25 1.82.414 3.024.414s2.273-.163 3.024-.414c.378-.126.648-.265.813-.395a.6.6 0 0 0 .146-.15l.015-.033L12 14v-.004a.3.3 0 0 0-.057-.09 1.3 1.3 0 0 0-.37-.264c-.376-.198-.943-.375-1.655-.493a.5.5 0 1 1 .164-.986c.77.127 1.452.328 1.957.594C12.5 13 13 13.4 13 14c0 .426-.26.752-.544.977-.29.228-.68.413-1.116.558-.878.293-2.059.465-3.34.465s-2.462-.172-3.34-.465c-.436-.145-.826-.33-1.116-.558C3.26 14.752 3 14.426 3 14c0-.599.5-1 .961-1.243.505-.266 1.187-.467 1.957-.594a.5.5 0 0 1 .575.411" />
                    </svg> Quiroga
                </span>
            </a>

            <a href="https://ejemplo.com/primary" class="text-decoration-none">
                <span class="badge rounded-pill text-bg-secondary d-inline-flex align-items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-geo" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M8 1a3 3 0 1 0 0 6 3 3 0 0 0 0-6M4 4a4 4 0 1 1 4.5 3.969V13.5a.5.5 0 0 1-1 0V7.97A4 4 0 0 1 4 3.999zm2.493 8.574a.5.5 0 0 1-.411.575c-.712.118-1.28.295-1.655.493a1.3 1.3 0 0 0-.37.265.3.3 0 0 0-.057.09V14l.002.008.016.033a.6.6 0 0 0 .145.15c.165.13.435.27.813.395.751.25 1.82.414 3.024.414s2.273-.163 3.024-.414c.378-.126.648-.265.813-.395a.6.6 0 0 0 .146-.15l.015-.033L12 14v-.004a.3.3 0 0 0-.057-.09 1.3 1.3 0 0 0-.37-.264c-.376-.198-.943-.375-1.655-.493a.5.5 0 1 1 .164-.986c.77.127 1.452.328 1.957.594C12.5 13 13 13.4 13 14c0 .426-.26.752-.544.977-.29.228-.68.413-1.116.558-.878.293-2.059.465-3.34.465s-2.462-.172-3.34-.465c-.436-.145-.826-.33-1.116-.558C3.26 14.752 3 14.426 3 14c0-.599.5-1 .961-1.243.505-.266 1.187-.467 1.957-.594a.5.5 0 0 1 .575.411" />
                    </svg> Membrillo
                </span>
            </a>

            <a href="https://ejemplo.com/primary" class="text-decoration-none">
                <span class="badge rounded-pill text-bg-warning d-inline-flex align-items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-hospital" viewBox="0 0 16 16">
                        <path d="M8.5 5.034v1.1l.953-.55.5.867L9 7l.953.55-.5.866-.953-.55v1.1h-1v-1.1l-.953.55-.5-.866L7 7l-.953-.55.5-.866.953.55v-1.1zM13.25 9a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5a.25.25 0 0 0 .25-.25v-.5a.25.25 0 0 0-.25-.25zM13 11.25a.25.25 0 0 1 .25-.25h.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25zm.25 1.75a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5a.25.25 0 0 0 .25-.25v-.5a.25.25 0 0 0-.25-.25zm-11-4a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5A.25.25 0 0 0 3 9.75v-.5A.25.25 0 0 0 2.75 9zm0 2a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5a.25.25 0 0 0 .25-.25v-.5a.25.25 0 0 0-.25-.25zM2 13.25a.25.25 0 0 1 .25-.25h.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25z" />
                        <path d="M5 1a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v1a1 1 0 0 1 1 1v4h3a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1h3V3a1 1 0 0 1 1-1zm2 14h2v-3H7zm3 0h1V3H5v12h1v-3a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1zm0-14H6v1h4zm2 7v7h3V8zm-8 7V8H1v7z" />
                    </svg> Farmacia de Turno
                </span>
            </a>
        </nav>
    </div>
</div>

<div id="map" style="width: 100%; height: 80vh; max-width: 100%; margin: 0; padding: 0;"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

<script>
var map = L.map('map').setView([0, 0], 4);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap'
}).addTo(map);

var coordinates = @Html.Raw(Json.Encode(Model));
var bounds = L.latLngBounds();
var userMarker = null;

// Función para mostrar las coordenadas en el mapa
function mostrarCoordenadas(coords) {
    coords.forEach(function(coord) {
        var marker = L.marker([coord.Latitude, coord.Longitude]).addTo(map);

        var popupContent = `
            <b>Lat:</b> ${coord.Latitude}<br>
            <b>Lon:</b> ${coord.Longitude}<br>
            <button onclick="traceRoute(${coord.Latitude}, ${coord.Longitude})"
               style="display:inline-block; margin-top:5px; padding:5px 10px; background:#28a745; color:white; border:none; cursor:pointer; border-radius:5px;">
               Ir
            </button>
            <button onclick="cargarDatos(${coord.Id})"
               style="display:inline-block; margin-top:5px; margin-left:5px; padding:5px 10px; background:#007bff; color:white; border:none; cursor:pointer; border-radius:5px;">
               Más
            </button>
        `;

        marker.bindPopup(popupContent);
        bounds.extend(marker.getLatLng());
    });

    if (coords.length > 0) {
        map.fitBounds(bounds);
    } else {
        map.setView([0, 0], 2);
    }
}

// Función para obtener la ubicación actual y mostrarla en el mapa
function showCurrentLocation() {
    getCurrentLocation(function (lat, lon) {
        if (userMarker) {
            userMarker.setLatLng([lat, lon]);
        } else {
            userMarker = L.marker([lat, lon]).addTo(map)
                .bindPopup("Aquí estoy").openPopup();
        }
        map.setView([lat, lon], 14);
    });
}

function getCurrentLocation(callback) {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            function (position) {
                callback(position.coords.latitude, position.coords.longitude);
            },
            function () {
                alert("No se pudo obtener la ubicación actual.");
            }
        );
    } else {
        alert("La geolocalización no es compatible con este navegador.");
    }
}

// Función para llamar a la acción "CargarDatos"
function cargarDatos(id) {
    $.ajax({
        url: "/Turismos/CargarDatos",
        type: "GET",
        data: { id: id },
        success: function (response) {
            alert("Datos cargados: " + response);
        },
        error: function () {
            alert("Error al cargar datos.");
        }
    });
}

// Función para trazar la ruta con Google Maps
function traceRoute(destLat, destLon) {
    getCurrentLocation(function (currentLat, currentLon) {
        window.open(`https://www.google.com/maps/dir/${currentLat},${currentLon}/${destLat},${destLon}/`, "_blank");
    });
}

// Mostrar las coordenadas al cargar el mapa
mostrarCoordenadas(coordinates);

// Agregar menú de filtros en el mapa
var categorias = ['Cafeterías', 'Parques', 'Museos'];

var filterControl = L.control({ position: 'topright' });

filterControl.onAdd = function () {
    var div = L.DomUtil.create('div', 'leaflet-control leaflet-control-custom');
    var select = '<select id="categoryFilter" style="padding:5px; width: 250px;">';
    select += '<option value="all">Todas</option>';
    categorias.forEach(function (cat) {
        select += `<option value="${cat}">${cat}</option>`;
    });
    select += '</select>';
    div.innerHTML = select;
    div.firstChild.onmousedown = div.firstChild.ondblclick = L.DomEvent.stopPropagation;
    return div;
};

filterControl.addTo(map);

// Agregar botón para mostrar ubicación
var locationControl = L.control({ position: 'topright' });
locationControl.onAdd = function () {
    var div = L.DomUtil.create('div', 'leaflet-control leaflet-control-custom');
    div.innerHTML = '<button onclick="showCurrentLocation()" style="padding:5px 10px; background:#dc3545; color:white; border:none; cursor:pointer; border-radius:5px;">Mi Ubicación</button>';
    div.firstChild.onmousedown = div.firstChild.ondblclick = L.DomEvent.stopPropagation;
    return div;
};
locationControl.addTo(map);

// Agregar botón de búsqueda en el mapa
var searchControl = L.control({ position: 'topright' });
    searchControl.onAdd = function () {
        var div = L.DomUtil.create('div', 'leaflet-control leaflet-control-custom');
        div.innerHTML = '<input id="searchInput" type="text" placeholder="Buscar ubicación" style="padding:5px; width: 150px;">';
        div.firstChild.onmousedown = div.firstChild.ondblclick = L.DomEvent.stopPropagation;
        return div;
    };

searchControl.addTo(map);

    // Evento para mostrar mensaje al cambiar el filtro
    document.getElementById("categoryFilter").addEventListener("change", function () {
        alert("Filtro seleccionado: " + this.value);
    });

</script>





